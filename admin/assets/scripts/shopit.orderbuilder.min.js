$(document).ready(function(){$("body").on("click","#additemtoorder",function(e){e.preventDefault();var t=$('input[name="new_product_id"]').val(),n=$('input[name="new_cat_id"]').val(),i=$('input[name="new_product_no"]').val(),a=$('input[name="new_product_name"]').val(),r=$('input[name="new_product_qty"]').val(),o=$('input[name="new_product_price"]').val(),p=$('input[name="new_product_weight"]').val(),d=$('input[name="volume_discounts_installed"]').val();if(""!=d)var u='data-url="'+d+'" data-product_id="'+t+'"',l=" volume-discounts-ajax-price";else var u="",l="";$("#tblOrderInventory tbody").append('<tr class="highlight"><td><input type="hidden" name="order_inventory_id[]" value="0" /><input type="hidden" name="product_id[]" value="'+t+'" /><input type="hidden" name="cat_id[]" value="'+n+'" /><input name="product_no[]" value="'+i+'" class="textbox" size="15" /></td><td><input name="product_name[]" value="'+a+'" class="textbox" size="50" /></td><td><input name="product_qty[]" value="'+r+'" class="textbox centered '+l+'" size="3" '+u+' /></td><td><input name="product_price[]" value="'+o+'" class="textbox" size="10" /><input type="hidden" name="product_weight[]" value="'+p+'" /></td><td><a href="#" class="button removeitemfromorder">Remove item</a><input type="hidden" name="remove[]" value="no" /></td></tr>'),$('input[name="new_product_id"]').val(""),$('input[name="new_cat_id"]').val(""),$('input[name="new_product_no"]').val(""),$('input[name="new_product_name"]').val(""),$('input[name="new_product_qty"]').val("").attr("data-product_id",""),$('input[name="new_product_price"]').val(""),$('input[name="new_product_weight"]').val("")}),$("body").on("click",".removeitemfromorder",function(e){e.preventDefault(),$(this).closest("tr").hide(),$(this).closest("tr").find('input[name="remove[]"]').val("yes"),$(this).closest("tr").find('input[name="product_price[]"]').val(0)}),$("input#samefordelivery").click(function(){$("input#samefordelivery").is(":checked")&&($('select[name="delivery_title"]').val($('select[name="billing_title"]').val()),$('input[name="delivery_firstname"]').val($('input[name="billing_firstname"]').val()),$('input[name="delivery_surname"]').val($('input[name="billing_surname"]').val()),$('input[name="delivery_company"]').val($('input[name="billing_company"]').val()),$('input[name="delivery_address1"]').val($('input[name="billing_address1"]').val()),$('input[name="delivery_address2"]').val($('input[name="billing_address2"]').val()),$('input[name="delivery_city"]').val($('input[name="billing_city"]').val()),$('input[name="delivery_postcode"]').val($('input[name="billing_postcode"]').val()),$('select[name="delivery_country"]').val($('select[name="billing_country"]').val()))}),$("#content input").keyup(function(){$("#order_changes").val("true")}),$("#content select").change(function(){$("#order_changes").val("true")}),$(".customerLookup").fancybox({autoSize:!1,width:970,height:450,padding:10,margin:0,centerOnScroll:!0,type:"iframe"}),$("#shopit_content").on("click","#productLookup",function(){var e=$(this).data("url"),t=$('input[name="new_product_name"]').val(),n=$('[name="site"]').val();$(this).attr("href",e+"/"+t+"/"+n)}),$("#productLookup").fancybox({autoSize:!1,width:970,height:450,padding:10,margin:0,centerOnScroll:!0,type:"iframe"}),$("#getShippingOptions").bind("click",function(){var e="",t="",n=$('[name="delivery_country"]').val(),i="",i=$('input[name="cat_id[]"]').map(function(){return $(this).val()}).get().join(",");$('input[name="product_qty[]"]').each(function(){var n=$(this).val(),i=$(this).closest("tr").find('input[name="product_price[]"]').val(),a=$(this).closest("tr").find('input[name="product_weight[]"]').val();e=1*e+n*i,t=1*t+n*a}),e>0||t>0?$("#getShippingOptions").attr("href","/admin/index.php/shipping/lookup/"+encodeURI(n)+"/"+e.toFixed(2)+"/"+t.toFixed(3)+"/"+i):$("#getShippingOptions").attr("href","/admin/index.php/shipping/lookup/"+encodeURI(n)),$(this).fancybox({autoSize:!1,width:970,height:450,padding:10,margin:0,centerOnScroll:!0,type:"iframe"})}),$("#getShippingOptions").trigger("click"),$("#getTotal").click(function(e){e.preventDefault();var t=$(this).attr("href"),n=0,i=$('input[name="order_shipping"]').val(),a=$('input[name="order_vat"]').val(),r=$('input[name="order_discount"]').val();$('input[name="product_qty[]"]').each(function(){var e=$(this).val(),t=$(this).closest("tr").find('input[name="product_price[]"]').val();n=1*n+e*t}),a=$('input[name="auto_vat"]').is(":checked")?"auto":$('input[name="order_vat"]').val(),$.post(t,{order_total:n,order_shipping:i,order_vat:a,order_discount:r},function(e){$("#orderTotal").html(e.total),$('input[name="order_vat"]').val(e.order_vat)},"json")}),$("body").on("keyup","input.volume-discounts-ajax-price",function(){var e=$(this).data("url"),t=$(this).val(),n=$('[name="site"]').val(),i=$(this).closest("tr"),a=i.find('input[name*="product_id"]').val(),r=new Date;a>0&&$.ajax({type:"POST",url:e+"?_="+r.getTime(),data:{product_id:a,qty:t,channel_id:n},dataType:"json",success:function(e){i.find('input[name*="product_price"]').val(e.price)}})})});